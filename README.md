# Микровервис для регистрации фактов прихода и списания книг.
В данном сервисе пользователь с ролью Администратор или Библиотекарь может создать/получить/отредактировать/удалить экземпляр книги, факты прихода и списания книг, причину списания книги. В факте прихода фиксируется дата прихода и экземпляр книги. В факте списания фиксируется экземпляр книги, дата списания и причина списания.


## Сущности:
+ Экземпляр книги
+ Факт прихода
+ Факт списания
+ Причина списания


## Действия акторов:
### Пользователь с ролью Администратор или Библиотекарь может:
- Создать/получить/отредактировать/удалить Экземпляр книги
- Создать/получить/отредактировать/удалить Факт прихода книги
- Создать/получить/отредактировать/удалить Факт списания книги
- Создать/получить/отредактировать/удалить Причину списания книги

### Сервис Каталог может:
- Получить Экземпляр книги
- Получить Факт прихода книги
- Получить Факт списания книги
- Получить Причину списания книги


## Ограничения:
+ Нельзя зарегистрировать больше одного факта прихода и списания для одного экземпляра книги.
+ Для одного экземпляра книги нельзя, чтобы дата в факте списания была раньше, чем дата в факте прихода.
+ Инвентарные номера у экземпляров книг не должны совпадать.
+ Нельзя удалить факт прихода, если для того же экземпляра книги есть факт списания.


## Информация о сущностях:

### Экземпляр книги
+ ID
+ Книга (из сервиса Catalog)
+ Инвентарный номер

### Факт прихода
+ ID
+ Экземпляр книги
+ Дата
+ Пользователь (из сервиса Авторизации, аутентификации и Регистрации)

### Факт списания
+ ID
+ Экземпляр книги
+ Дата
+ Пользователь (из сервиса Авторизации, аутентификации и Регистрации)
+ Причина списания

### Причина списания
+ ID
+ Описание


## Диаграмма вариантов использования сервиса ReceiptWriteOff

[![Диаграмма вариантов использования сервиса ReceiptWriteOff](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/Use%20cases%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.png)](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/Use%20cases%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.png)
[Ссылка на картинку](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/Use%20cases%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.png)

[Ссылка на исходник схемы](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/Use%20cases%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.drawio)


## БД сервиса ReceiptWriteOff

### ER-диаграмма
[![ER-диаграмма БД сервиса ReceiptWriteOff](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/ER-%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%91%D0%94%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.drawio.png)](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/ER-%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%91%D0%94%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.drawio.png)
[Ссылка на картинку](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/ER-%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%91%D0%94%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.drawio.png)

[Ссылка на исходник схемы](https://github.com/SakhalinNovosibirskTomsk/ReceiptWriteOff/blob/main/Docs/ER-%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%91%D0%94%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20ReceiptWriteOff.drawio)

### Табличное описание

##### BookInstance - экземпляры книг

| Ключ                    | Наименование        | тип              | Описание                              | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | ------------------- | ---------------- | ------------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**              | int              | ID экземпляра книги                   |                         | not null, autoincrement                                             |
|                         | **BookId**          | int              | ID книги в сервисе Catalog            | <center>**FK**</center> | not null                                                            |
|                         | **InventoryNumber** | int              | Инвентарный номер                     |                         | not null                                                            |

##### ReceiptFact - факты прихода книг

| Ключ                    | Наименование        | тип              | Описание                              | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | ------------------- | ---------------- | ------------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**              | int              | ID факта прихода                      |                         | not null, autoincrement                                             |
|                         | **BookInstanceId**  | int              | ID экземпляра книги                   | <center>**FK**</center> | not null                                                            |
|                         | **Date**            | datetime         | Дата прихода                          |                         |                                                                     |
|                         | **UserId**          | int              | ID пользователя                       | <center>**FK**</center> | not null                                                            |

##### WriteOffFact - факты списания книг

| Ключ                    | Наименование         | тип              | Описание                              | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | -------------------- | ---------------- | ------------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**               | int              | ID факта списания                     |                         | not null, autoincrement                                             |
|                         | **BookInstanceId**   | int              | ID экземпляра книги                   | <center>**FK**</center> | not null                                                            |
|                         | **Date**             | datetime         | Дата прихода                          |                         |                                                                     |
|                         | **UserId**           | int              | ID пользователя                       | <center>**FK**</center> | not null                                                            |
|                         | **WriteOffReasonId** | int              | ID причины списания                   | <center>**FK**</center> | not null                                                            |

##### WriteOffReason - причины списания книг

| Ключ                    | Наименование         | тип              | Описание                              | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | -------------------- | ---------------- | ------------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**               | int              | ID причины списания                   |                         | not null, autoincrement                                             |
|                         | **Description**      | nvarchar(200)    | Описание                              |                         | not null                                                            |
